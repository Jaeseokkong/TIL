# Caching
Next.jsì˜ ê°€ì¥ í•µì‹¬ì ì¸ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ëŠ” **Caching**ì…ë‹ˆë‹¤. Next.jsëŠ” ë‹¤ì–‘í•œ ìºì‹± ì „ëµì„ í†µí•´ í˜ì´ì§€ ë¡œë”© ì†ë„ë¥¼ í–¥ìƒì‹œí‚¤ê³ , ì„œë²„ ë¶€í•˜ë¥¼ ì¤„ì´ë©°, íš¨ìœ¨ì ì¸ ë°ì´í„° ê´€ë¦¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

> ğŸ’¡ Next.jsì˜ ìºì‹± ë°©ì‹  
> Next.jsëŠ” í¬ê²Œ ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ìºì‹±ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
>- **Full Route Cache (ë¹Œë“œ ì‹œì  ìºì‹±)**
>- **Data Cache (ìš”ì²­ ì‹œì  ìºì‹±)**

ì´ ë‘ ê°€ì§€ ë°©ì‹ `fetch` í•¨ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ë©°, Next.jsì˜ `fetch` APIëŠ” ë¸Œë¼ìš°ì €ì˜ `fetch` APIë¥¼ í™•ì¥í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.


## 1ï¸âƒ£ Full Route Cache
Next.jsëŠ” ë¹Œë“œ ì‹œì ì— í˜ì´ì§€ë¥¼ ë Œë”ë§í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ ìºì‹±í•˜ëŠ” **Full Route Cache** ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ë°©ì‹ì€ SSG(Static Site Generation)ì™€ í•¨ê»˜ ë™ì‘í•˜ë©°, ë¯¸ë¦¬ ìƒì„±ëœ HTMLê³¼ ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ì œê³µí•˜ì—¬ í˜ì´ì§€ ë¡œë”© ì†ë„ë¥¼ ìµœì í™”í•©ë‹ˆë‹¤.
### ğŸ”¹ ë™ì‘ ë°©ì‹
1. React Server Component Payload ìƒì„±  
ì„œë²„ì—ì„œ React Server Componentë¥¼ ë Œë”ë§ í•˜ê³ , ìŠ¤íŠ¸ë¦¬ë°ì— ìµœì í™”ëœ ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

2. HTML ìƒì„±  
Next.jsëŠ” ìƒì„±ëœ *Payloadì™€ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì˜ JavaScriptë¥¼ ê²°í•©í•˜ì—¬ ìµœì¢… HTMLì„ ì™„ì„±í•©ë‹ˆë‹¤.

3. ìºì‹± ì ìš©  
ë¹Œë“œ ì‹œì ì— ìƒì„±ëœ HTMLì´ CDNì— ë°°í¬ë˜ê³ , ì´í›„ ë™ì¼í•œ í˜ì´ì§€ ìš”ì²­ì´ ë°œìƒí•˜ë©´ ìºì‹œëœ HTMLì„ ë°˜í™˜í•©ë‹ˆë‹¤.

> ğŸ’¡ *Payload*  
Next.jsì—ì„œ **React Server Component Payload** ëŠ” ì„œë²„ì—ì„œ ë Œë”ë§ëœ **ì»´í¬ë„ŒíŠ¸ì˜ ë°ì´í„°ì™€ ìƒíƒœ ì •ë³´ë¥¼ í¬í•¨í•œ íŠ¹ë³„í•œ í˜•ì‹ì˜ ë°ì´í„°**ì…ë‹ˆë‹¤. ì´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ HTMLì„ ìµœì¢…ì ìœ¼ë¡œ ìƒì„±í•˜ê²Œ ë©ë‹ˆë‹¤.  

### ğŸ”¹ Full Route Cache ë¬´íš¨í™” (Revalidation)
ë°ì´í„°ê°€ ë³€ê²½ë˜ì—ˆê±°ë‚˜ ì‹¤ì‹œê°„ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš°, `revalidate` ì˜µì…˜ì„ í†µí•´ ìºì‹œë¥¼ ë¬´íš¨í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (IRS)
```tsx
const data = await fetch('https://api.example.com/data', {
  next: { revalidate: 60 }, // 60ì´ˆë§ˆë‹¤ ìºì‹œ ê°±ì‹ 
});
```

<br>

- - -

<br>

## 2ï¸âƒ£ Data Cache
Data CacheëŠ” `fetch` ìš”ì²­ì„ í†µí•´ ê°€ì ¸ì˜¨ API ë°ì´í„°ë¥¼ ìºì‹±í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì´ ë°©ì‹ì€ API ìš”ì²­ ìˆ˜ë¥¼ ì¤„ì´ê³  ì‘ë‹µ ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

### ğŸ”¹ ë™ì‘ ë°©ì‹
-  `fetch` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ìë™ìœ¼ë¡œ ë°ì´í„°ê°€ ìºì‹±  
fetchëŠ” `cache` ì˜µì…˜ ê°’ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ `{ cache: 'force-cache' }`ì…ë‹ˆë‹¤.

- ìºì‹±ëœ ë°ì´í„°ëŠ” `revalidate` ì˜µì…˜ì„ í†µí•´ ì¼ì • ì‹œê°„ë§ˆë‹¤ ê°±ì‹ í•  ìˆ˜ ìˆìŒ

- `{ cache: 'no-store' }` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ìºì‡ ì—†ì´ í•­ìƒ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´

```tsx
// default
const res = await fetch('https://api.example.com/data'); // { cache: "force-cache" }ì™€ ë™ì¼
const data = await res.json();

// ë°ì´í„° ìºì‹± (3600ì´ˆ ë™ì•ˆ ìœ ì§€)
const res = await fetch('https://api.example.com/data', {
  next: { revalidate: 3600 },
});
const data = await res.json();

// ìºì‹± ì—†ì´ í•­ìƒ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°
const res = await fetch('https://api.example.com/data', {
  cache: 'no-store',
});
const data = await res.json();
```

<br>

- - -

<br>

## 3ï¸âƒ£ Request Memoization
**Request Memoization**ì€ ì„œë²„ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ì¤‘ ë™ì¼í•œ `fetch` ìš”ì²­ì´ ì—¬ëŸ¬ ë²ˆ ë°œìƒí•´ë„, ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì€ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ ìµœì í™”í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

```tsx
async function getCommonData() {
  const res = await fetch('https://api.example.com/common-data');
  return res.json();
}

const dataA = await getCommonData();
const dataB = await getCommonData(); // ë‘ ë²ˆì§¸ í˜¸ì¶œì—ì„œëŠ” ì²« ë²ˆì§¸ ê²°ê³¼ë¥¼ ì¬ì‚¬ìš©
```
âœ”ï¸ ì´ ê¸°ëŠ¥ì€ ì„œë²„ ì»´í¬ë„ŒíŠ¸ì˜ ë Œë”ë§ ê³¼ì •ì—ì„œë§Œ ìœ ì§€ë˜ë©°, ìš”ì²­ì´ ì™„ë£Œë˜ë©´ ìºì‹œëŠ” ì´ˆê¸°í™”ë©ë‹ˆë‹¤.

<br>

- - -

<br>

## 4ï¸âƒ£ Next.js ìºì‹± ê´€ë ¨ ì£¼ìš” ë©”ì„œë“œ
### ğŸ”¹ `generateStaticParams`
ì •ì  ê²½ë¡œë¥¼ ìƒì„±í•˜ì—¬ ë¹Œë“œ ì‹œì ì— ìºì‹±ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```tsx
export async function generateStaticParams() {
  const posts = await fetch('https://api.example.com/posts').then((res) => res.json());
  return posts.map((post) => ({ slug: post.slug }));
}

export default function Page({ params }) {
  const { slug } = params;
}
```

âœ”ï¸ `generateStaticParam`sëŠ” ë™ì  ê²½ë¡œë¥¼ ë¯¸ë¦¬ ìƒì„±í•˜ì—¬ ì •ì  í˜ì´ì§€ë¡œ ë¹Œë“œí•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.

### ğŸ”¹ `tags`
íŠ¹ì • ë°ì´í„°ì— íƒœê·¸ë¥¼ ë¶€ì—¬í•˜ì—¬ ìºì‹œë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```tsx
fetch('https://api.example.com/products', {
  next: {
    revalidate: 60, // 60ì´ˆë§ˆë‹¤ ê°±ì‹ 
    tags: ['product', 'category'],
  },
});
```

âœ”ï¸ íƒœê·¸ë¥¼ í™œìš©í•˜ë©´ íŠ¹ì • ë°ì´í„° ê·¸ë£¹ì„ ì†ì‰½ê²Œ ìºì‹œ ë¬´íš¨ë¡¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ”¹ `revalidate`
ISR(Incremental Static Regeneration) ë°©ì‹ìœ¼ë¡œ ìºì‹œë¥¼ ì¼ì • ì£¼ê¸°ë¡œ ê°±ì‹ í•©ë‹ˆë‹¤.
```tsx
fetch('/api/data', {
  next: { revalidate: 10 },
});
```

âœ”ï¸ `revalidate`ë¥¼ ì‚¬ìš©í•˜ë©´ í˜ì´ì§€ë‚˜ ë°ì´í„°ì˜ ìë™ ê°±ì‹  ì£¼ê¸°ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


### ğŸ”¹ `revalidateTags`
íƒœê·¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŠ¹ì • ë°ì´í„°ë¥¼ ë¬´íš¨í™”í•˜ê³  ê°±ì‹ í•©ë‹ˆë‹¤.
```tsx
import { revalidateTag } from 'next/cache';

async function updateProduct() {
  revalidateTag('product');
  return { message: 'Product data updated' };
}
```

âœ”ï¸ `revalidateTag`ëŠ” íŠ¹ì • íƒœê·¸ì— ì—°ê²°ëœ ë°ì´í„°ë¥¼ ì¦‰ì‹œ ê°±ì‹ í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.

### ğŸ”¹ `revalidatePath`
íŠ¹ì • ê²½ë¡œì˜ **Full Route Cache**ë¥¼ ë¬´íš¨í™”í•˜ê³  ê°±ì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```tsx
import { revalidatePath } from 'next/cache';

async function updatePage() {
  revalidatePath('/products');
  return { message: 'Product page cache updated' };
}
```

âœ”ï¸ `revalidatePath('/ê²½ë¡œ')`ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ ê²½ë¡œì˜ ì •ì  í˜ì´ì§€ê°€ **ë‹¤ì‹œ ìƒì„±**ë©ë‹ˆë‹¤.  
âœ”ï¸ ì£¼ë¡œ SSG(Static Site Generation) ë° ISR(Incremental Static Regeneration)ì—ì„œ í™œìš©ë©ë‹ˆë‹¤.  
âœ”ï¸ ë°ì´í„° ë³€ê²½ ì‹œ ì „ì²´ í˜ì´ì§€ë¥¼ ê°±ì‹ í•  í•„ìš” ì—†ì´ íŠ¹ì • ê²½ë¡œë§Œ ê°±ì‹ í•  ìˆ˜ ìˆì–´ íš¨ìœ¨ì ì…ë‹ˆë‹¤.