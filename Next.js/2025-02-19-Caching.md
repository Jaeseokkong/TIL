# Caching
Next.js의 가장 핵심적인 기능 중 하나는 **Caching**입니다. Next.js는 다양한 캐싱 전략을 통해 페이지 로딩 속도를 향상시키고, 서버 부하를 줄이며, 효율적인 데이터 관리를 제공합니다.

> 💡 Next.js의 캐싱 방식  
> Next.js는 크게 두 가지 방식으로 캐싱을 수행합니다.
>- **Full Route Cache (빌드 시점 캐싱)**
>- **Data Cache (요청 시점 캐싱)**

이 두 가지 방식 `fetch` 함수를 기반으로 동작하며, Next.js의 `fetch` API는 브라우저의 `fetch` API를 확장한 기능을 제공합니다.


## 1️⃣ Full Route Cache
Next.js는 빌드 시점에 페이지를 렌더링하고 그 결과를 캐싱하는 **Full Route Cache** 기능을 제공합니다. 이 방식은 SSG(Static Site Generation)와 함께 동작하며, 미리 생성된 HTML과 데이터를 빠르게 제공하여 페이지 로딩 속도를 최적화합니다.
### 🔹 동작 방식
1. React Server Component Payload 생성  
서버에서 React Server Component를 렌더링 하고, 스트리밍에 최적화된 데이터 형식으로 변환합니다.

2. HTML 생성  
Next.js는 생성된 *Payload와 클라이언트 컴포넌트의 JavaScript를 결합하여 최종 HTML을 완성합니다.

3. 캐싱 적용  
빌드 시점에 생성된 HTML이 CDN에 배포되고, 이후 동일한 페이지 요청이 발생하면 캐시된 HTML을 반환합니다.

> 💡 *Payload*  
Next.js에서 **React Server Component Payload** 는 서버에서 렌더링된 **컴포넌트의 데이터와 상태 정보를 포함한 특별한 형식의 데이터**입니다. 이 데이터를 기반으로 클라이언트에서 HTML을 최종적으로 생성하게 됩니다.  

### 🔹 Full Route Cache 무효화 (Revalidation)
데이터가 변경되었거나 실시간 정보가 필요한 경우, `revalidate` 옵션을 통해 캐시를 무효화할 수 있습니다. (IRS)
```tsx
const data = await fetch('https://api.example.com/data', {
  next: { revalidate: 60 }, // 60초마다 캐시 갱신
});
```

<br>

- - -

<br>

## 2️⃣ Data Cache
Data Cache는 `fetch` 요청을 통해 가져온 API 데이터를 캐싱하는 방식입니다. 이 방식은 API 요청 수를 줄이고 응답 속도를 높이기 위해 사용됩니다.

### 🔹 동작 방식
-  `fetch` 함수를 사용하면 자동으로 데이터가 캐싱  
fetch는 `cache` 옵션 값을 지정하지 않으면 기본적으로 `{ cache: 'force-cache' }`입니다.

- 캐싱된 데이터는 `revalidate` 옵션을 통해 일정 시간마다 갱신할 수 있음

- `{ cache: 'no-store' }` 옵션을 사용하면 캐잇 없이 항상 새로운 데이터를 가져옴

```tsx
// default
const res = await fetch('https://api.example.com/data'); // { cache: "force-cache" }와 동일
const data = await res.json();

// 데이터 캐싱 (3600초 동안 유지)
const res = await fetch('https://api.example.com/data', {
  next: { revalidate: 3600 },
});
const data = await res.json();

// 캐싱 없이 항상 새로운 데이터를 가져오기
const res = await fetch('https://api.example.com/data', {
  cache: 'no-store',
});
const data = await res.json();
```

<br>

- - -

<br>