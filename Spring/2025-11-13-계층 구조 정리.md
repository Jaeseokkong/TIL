# ğŸ—ï¸ Spring ê³„ì¸µ êµ¬ì¡° ì •ë¦¬ 

## 1ï¸âƒ£ ìš”ì²­ íë¦„ ê°œìš”

Spring ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ê°€ ì´ë™í•˜ëŠ” ì¼ë°˜ì ì¸ íë¦„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```arduino
Client â†’ Controller â†’ DTO â†’ Service â†’ Entity â†’ DAO/Repository â†’ DB
       â†•
     Response DTO
```

- **Client**: ë¸Œë¼ìš°ì €, ëª¨ë°”ì¼ ì•± ë“±
- **Controller**: ìš”ì²­ ìˆ˜ì‹ , DTO ë³€í™˜, Service í˜¸ì¶œ, ì‘ë‹µ ë°˜í™˜
- **DTO**: ìš”ì²­/ì‘ë‹µ ë°ì´í„° ìº¡ìŠí™”
- **Service**: ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬, Entity ë³€í™˜, DAO í˜¸ì¶œ
- **Entity**: DB í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” ê°ì²´, ìƒíƒœì™€ ë‚ ì§œ ê´€ë¦¬
- **DAO/Repository**: DB ì ‘ê·¼, Entity CRUD ìˆ˜í–‰
- **DB**: ì‹¤ì œ ë°ì´í„° ì €ì¥ ë° ì¡°íšŒ

> ğŸ’¡ ì´ êµ¬ì¡°ë¥¼ ë”°ë¥´ë©´ ê° ê³„ì¸µ ì±…ì„ì´ ëª…í™•í•´ì§€ê³ , ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ì›Œì§‘ë‹ˆë‹¤.

---

## 1ï¸âƒ£ êµ¬ì¡° ê°œìš”
```markdown
Controller â†’ Service â†’ DAO/Repository â†’ Entity
       â†•
     DTO (ì…ì¶œë ¥ìš©)
```

|ê³„ì¸µ|ì—­í• |
|Controller|í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì²˜ë¦¬, DTO ë³€í™˜, ê²°ê³¼ ë°˜í™˜|
|Service|ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§, ê²€ì¦, Entity ìƒì„±/ì—…ë°ì´íŠ¸|
|DAO / Respository|DB ì ‘ê·¼, Entity CRUD ìˆ˜í–‰|
|Entity|DB í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” ê°ì²´, ì˜ì†ì„± ê´€ë¦¬|
|DTO|ë°ì´í„° ì „ì†¡ ê°ì²´, API ìš”ì²­/ì‘ë‹µ ìš©ë„|

---

## 2ï¸âƒ£ Entity (Reservation)

- DB í…Œì´ë¸”ê³¼ 1:1 ë§¤í•‘ë˜ëŠ” ê°ì²´
- JPA ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ í•„ë“œ ì†ì„±, PK, ìƒì„±/ìˆ˜ì •ì¼ ìë™ ì²˜ë¦¬

```java
@Entity
@Table(name = "reservation")
public class Reservation {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true, length = 64)
    private String token;

    @Column(name = "customer_name", nullable = false, length = 200)
    private String customerName;

    @Enumerated(EnumType.STRING)
    private Status status;

    @Temporal(TemporalType.TIMESTAMP)
    private Date createdAt;

    @Temporal(TemporalType.TIMESTAMP)
    private Date updatedAt;

    @PrePersist
    protected void onCreate() {
        createdAt = new Date();
        updatedAt = new Date();
        status = Status.ACTIVE;
    }

    @PreUpdate
    protected void onUpdate() {
        updatedAt = new Date();
    }

    // getter / setter ...
}
```

- EntityëŠ” **DB ì¤‘ì‹¬ ì„¤ê³„**
- ìƒíƒœê°’, ë‚ ì§œëŠ” **Enum, Temporal**ë¡œ ì²˜ë¦¬
- @PrePersist / @PreUpdateë¡œ **ìƒì„±/ìˆ˜ì •ì¼ ìë™ ê´€ë¦¬**

---

## 3ï¸âƒ£ DTO

- API ìš”ì²­ê³¼ ì‘ë‹µìš© ë°ì´í„° ê°ì²´
- Entityë¥¼ ê·¸ëŒ€ë¡œ ì“°ì§€ ì•Šê³ , **í•„ìš”í•œ ì •ë³´ë§Œ ì „ë‹¬**

```java
public class ReservationDto {
    private String customerName;
    private String customerPhone;
    private String regionSido;
    private DesiredOpeningType desiredOpeningType;
    private Date scheduleAt;
    // getter / setter
}

public class ReservationResponseDto extends ReservationDto {
    private Long id;
    private Date createdAt;
    private Status status;
    private String errorMessage;
    // getter / setter
}
```

- DTOëŠ” **ì»¨íŠ¸ë¡¤ëŸ¬ ì…ì¶œë ¥ ì „ìš©**
- Validation, Error ë©”ì‹œì§€, ì‘ë‹µ êµ¬ì¡° ê´€ë¦¬ ê°€ëŠ¥
- Entityì™€ 1:1 ë§¤í•‘ í•„ìš” ì—†ìŒ

---

## 4ï¸âƒ£ Service

- ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ì¤‘ì‹¬
- DTO ê²€ì¦, Entity ë³€í™˜, DB ì ‘ê·¼

```java
@Service
public class ReservationService {

    @Autowired
    private ReservationDao reservationDao;

    public Result<ReservationResponseDto> createReservation(ReservationDto dto) {

        // 1ï¸âƒ£ Validation
        Result<String> validation = validate(dto);
        if (validation.isError()) {
            ReservationResponseDto response = new ReservationResponseDto();
            response.setErrorMessage(validation.payload());
            return Result.error(response);
        }

        // 2ï¸âƒ£ DTO â†’ Entity
        Reservation reservation = dtoToEntity(dto);

        // 3ï¸âƒ£ DB ì €ì¥
        reservationDao.insert(reservation);

        // 4ï¸âƒ£ Response DTO ë³€í™˜
        ReservationResponseDto response = entityToDto(reservation);
        return Result.success(response);
    }

    private Reservation dtoToEntity(ReservationDto dto) {
        Reservation reservation = new Reservation();
        reservation.setToken(UUID.randomUUID().toString());
        reservation.setCustomerName(dto.getCustomerName());
        reservation.setCustomerPhone(dto.getCustomerPhone());
        reservation.setRegionSido(dto.getRegionSido());
        reservation.setDesiredOpeningType(dto.getDesiredOpeningType());
        reservation.setScheduleAt(dto.getScheduleAt());
        return reservation;
    }
}
```