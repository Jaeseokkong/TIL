# ğŸ—ï¸ Spring ê³„ì¸µ êµ¬ì¡° ì •ë¦¬ 

## 1ï¸âƒ£ ìš”ì²­ íë¦„ ê°œìš”

Spring ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ê°€ ì´ë™í•˜ëŠ” ì¼ë°˜ì ì¸ íë¦„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```arduino
Client â†’ Controller â†’ DTO â†’ Service â†’ Entity â†’ DAO/Repository â†’ DB
       â†•
     Response DTO
```

- **Client**: ë¸Œë¼ìš°ì €, ëª¨ë°”ì¼ ì•± ë“±
- **Controller**: ìš”ì²­ ìˆ˜ì‹ , DTO ë³€í™˜, Service í˜¸ì¶œ, ì‘ë‹µ ë°˜í™˜
- **DTO**: ìš”ì²­/ì‘ë‹µ ë°ì´í„° ìº¡ìŠí™”
- **Service**: ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬, Entity ë³€í™˜, DAO í˜¸ì¶œ
- **Entity**: DB í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” ê°ì²´, ìƒíƒœì™€ ë‚ ì§œ ê´€ë¦¬
- **DAO/Repository**: DB ì ‘ê·¼, Entity CRUD ìˆ˜í–‰
- **DB**: ì‹¤ì œ ë°ì´í„° ì €ì¥ ë° ì¡°íšŒ

> ğŸ’¡ ì´ êµ¬ì¡°ë¥¼ ë”°ë¥´ë©´ ê° ê³„ì¸µ ì±…ì„ì´ ëª…í™•í•´ì§€ê³ , ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ì›Œì§‘ë‹ˆë‹¤.

---

## 2ï¸âƒ£ Controller: ìš”ì²­ì˜ ì‹œì‘ì 

ControllerëŠ” í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ë°›ê³ , Servieì— ì „ë‹¬í•˜ë©°, ê²°ê³¼ë¥¼ ë‹¤ì‹œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë°˜í™˜í•˜ëŠ” **ìµœì´ˆ ì ‘ì **ì…ë‹ˆë‹¤.

### ğŸ› ï¸ ì—­í• 

- ìš”ì²­ URL ë§¤í•‘ (`@RequestMapping`, `@PostMapping` ë“±)
- HTTP ìš”ì²­ ë°ì´í„° ë°”ì¸ë”© (`@RequestBody`, `@RequestParam`)
- DTO ìƒì„±/ê²€ì¦ (ë‹¨ìˆœ ìˆ˜ì¤€)
- Service í˜¸ì¶œ
- Response DTO ë°˜í™˜

```java
@RestController
@RequestMapping("/api/reservation")
public class ReservationController {

    @Autowired
    private ReservationService reservationService;

    @PostMapping
    public Result<ReservationResponseDto> createReservation(@RequestBody ReservationDto requestDto) {
        // Service í˜¸ì¶œ
        return reservationService.createReservation(requestDto);
    }
}
```

> âœ… ControllerëŠ” **ë¡œì§ì„ ì§ì ‘ ì²˜ë¦¬í•˜ì§€ ì•Šê³ **, ìš”ì²­ê³¼ ì‘ë‹µì„ ì—°ê²°í•˜ëŠ” ì—­í• ë§Œ ìˆ˜í–‰

---

## 3ï¸âƒ£ DTO: ë°ì´í„° ìº¡ìŠí™”

DTO(Data Transfer Object)ëŠ” Controllerì™€ Service ì‚¬ì´ì—ì„œ ë°ì´í„°ë¥¼ **ì „ë‹¬ìš©ìœ¼ë¡œ ìº¡ìŠí™”**í•©ë‹ˆë‹¤.  
Entityë¥¼ ê·¸ë˜ë„ ì“°ë©´ DB êµ¬ì¡°ê°€ ì™¸ë¶€ APIì— ë…¸ì¶œë  ìˆ˜ ìˆê³ , ë¶ˆí•„ìš”í•œ í•„ë“œê¹Œì§€ ì „ë‹¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ› ï¸ ì—­í• 

- ìš”ì²­ ë°ì´í„° êµ¬ì¡° ì €ì˜
- ì‘ë‹µ ë°ì´í„° êµ¬ì¡° ì •ì˜
- Validation ìˆ˜í–‰ ê°€ëŠ¥ (í•„ìˆ˜ê°’, í˜•ì‹ ë“±)
- Entityì™€ 1:1 ë§¤í•‘ ë¶ˆí•„ìš”

```java
public class ReservationDto {
    private String customerName;
    private String customerPhone;
    private String regionSido;
    private DesiredOpeningType desiredOpeningType;
    private Date scheduleAt;
    // getter / setter
}

public class ReservationResponseDto extends ReservationDto {
    private Long id;
    private Date createdAt;
    private Status status;
    private String errorMessage;
    // getter / setter
}
```

> ğŸ’¡ DTOë¥¼ ì‚¬ìš©í•˜ë©´ **API ë³€ê²½ì— ë”°ë¥¸ DB ì˜í–¥ ìµœì†Œí™”**ê°€ ê°€ëŠ¥

---

## 4ï¸âƒ£ Service: ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ì¤‘ì‹¬

ServiceëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **í•µì‹¬ ë¡œì§ì„ ìˆ˜í–‰**í•˜ëŠ” ê³„ì¸µì…ë‹ˆë‹¤.

### ğŸ› ï¸ ì—­í• 

- ìš”ì²­ DTO ê²€ì¦
- Entity ë³€í™˜ (DTO â†’ Entity)
- DB CRUD ìˆ˜í–‰ (DAO í˜¸ì¶œ)
- ê²°ê³¼ DTO ìƒì„± (Entity â†’ Response DTO)
- íŠ¸ëœì­ì…˜ ê´€ë¦¬ (`@Transactional`)

```java
@Service
public class ReservationService {

    @Autowired
    private ReservationDao reservationDao;

    public Result<ReservationResponseDto> createReservation(ReservationDto dto) {

        // 1ï¸âƒ£ Validation
        if (dto.getCustomerName() == null) {
            ReservationResponseDto error = new ReservationResponseDto();
            error.setErrorMessage("ì˜ˆì•½ì ì´ë¦„ì€ í•„ìˆ˜ ì…ë ¥ì‚¬í•­ì…ë‹ˆë‹¤.");
            return Result.error(error);
        }

        // 2ï¸âƒ£ DTO â†’ Entity ë³€í™˜
        Reservation reservation = new Reservation();
        reservation.setToken(UUID.randomUUID().toString());
        reservation.setCustomerName(dto.getCustomerName());
        reservation.setRegionSido(dto.getRegionSido());
        reservation.setDesiredOpeningType(dto.getDesiredOpeningType());
        reservation.setScheduleAt(dto.getScheduleAt());

        // 3ï¸âƒ£ DB ì €ì¥
        reservationDao.insert(reservation);

        // 4ï¸âƒ£ Entity â†’ Response DTO ë³€í™˜
        ReservationResponseDto response = new ReservationResponseDto();
        response.setId(reservation.getId());
        response.setCustomerName(reservation.getCustomerName());
        response.setCreatedAt(reservation.getCreatedAt());
        response.setStatus(reservation.getStatus());

        return Result.success(response);
    }
}
```

> âœ… ServiceëŠ” **ë¡œì§ ì²˜ë¦¬ì˜ í•µì‹¬**  
âŒ Controllerì—ì„œ ì§ì ‘ DB ì ‘ê·¼ì´ë‚˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ë©´ ì±…ì„ì´ í˜¼ì¬ë¨

---

## Entity: DBì™€ ë§¤í•‘ë˜ëŠ” ë„ë©”ì¸ ê°ì²´

EntityëŠ” **DB í…Œì´ë¸”ê³¼ 1:1 ë§¤í•‘**ë˜ëŠ” ê°ì²´ì…ë‹ˆë‹¤.

### ğŸ› ï¸ ì—­í• 

- DB ì»¬ëŸ¼ ì •ì˜
- Enum, Temporal íƒ€ì… ë§¤í•‘
- ìƒì„±/ìˆ˜ì •ì¼ ìë™ ê´€ë¦¬ (`@PrePersist`, `@PreUpdate`)
- ì˜ì†ì„± ê´€ë¦¬(JPA/Hibernate)

```java
@Entity
@Table(name = "reservation")
public class Reservation {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true, length = 64)
    private String token;

    @Column(name = "customer_name", nullable = false, length = 200)
    private String customerName;

    @Enumerated(EnumType.STRING)
    private Status status;

    @Temporal(TemporalType.TIMESTAMP)
    private Date createdAt;

    @Temporal(TemporalType.TIMESTAMP)
    private Date updatedAt;

    @PrePersist
    protected void onCreate() {
        createdAt = new Date();
        updatedAt = new Date();
        status = Status.ACTIVE;
    }

    @PreUpdate
    protected void onUpdate() {
        updatedAt = new Date();
    }
}
```

>ğŸ’¡ Entity ì„¤ê³„ ì‹œ ì¤‘ìš”í•œ ì 
> - Enumì€ `STRING`ìœ¼ë¡œ ë§¤í•‘ â†’ ìˆœì„œ ë³€ê²½ ì•ˆì „
> - ë‚ ì§œëŠ” `TemporalType.TIMESTAMP` ì‚¬ìš©
> - DB ì œì•½ì¡°ê±´(`nullable`, `unique`, `length`)ì„ ì½”ë“œ ë ˆë²¨ì—ì„œ í‘œí˜„

---

## 6ï¸âƒ£ DAO / Repository: DB ì ‘ê·¼ ê³„ì¸µ

DAO(Data Access Object) ë˜ëŠ” RespositoryëŠ” Entityë¥¼ **ì‹¤ì œ DBì— ì €ì¥í•˜ê³  ì¡°íšŒ**í•˜ëŠ” ê³„ì¸µì…ë‹ˆë‹¤.

### ğŸ› ï¸ ì—­í• 

- CRUD ìˆ˜í–‰
- ë³µì¡í•œ Query ì²˜ë¦¬
- íŠ¸ëœì­ì…˜ ë²”ìœ„ ë‚´ì—ì„œ DB ì ‘ê·¼
- Serviceì— ë…¸ì¶œí•˜ì§€ ì•Šê³  Entityë§Œ ì£¼ê³ ë°›ìŒ

```java
@Repository
public class ReservationDao extends DaoBase {

    public Long insert(Reservation reservation) {
        return (Long) session().save(reservation);
    }

    public Reservation select(Long id) {
        return session().get(Reservation.class, id);
    }
}
```

>âœ… DAO/Repositoryê°€ ìˆìœ¼ë©´ ServiceëŠ” DB êµ¬í˜„ ì„¸ë¶€ì‚¬í•­ì„ ëª°ë¼ë„ ë¨  
âœ… ìœ ì§€ë³´ìˆ˜, í…ŒìŠ¤íŠ¸, DB ë³€ê²½ ìœ ì—°ì„±ì´ ì¢‹ì•„ì§

---

## 7ï¸âƒ£ ì „ì²´ ìš”ì²­/ì‘ë‹µ íë¦„ ì˜ˆì‹œ
1. í´ë¼ì´ì–¸íŠ¸ê°€ ì˜ˆì•½ ìš”ì²­ JSON ì „ì†¡
2. Controllerì—ì„œ ReservationDtoë¡œ ë°”ì¸ë”©
3. Serviceì—ì„œ DTO ê²€ì¦, Entity ë³€í™˜
4. DAOê°€ DBì— Entity ì €ì¥
5. Serviceì—ì„œ Entity â†’ Response DTO ë³€í™˜
6. Controllerê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ Response DTO ë°˜í™˜

---