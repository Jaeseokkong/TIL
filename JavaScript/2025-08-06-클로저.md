# 클로저 (Closure)

## 1️⃣ 핵심 개념: 클로저란?
### 🔹 정의
> **클로저(Closure)** 는 **함수**와 **그 함수가 선언될 당시의 렉시컬 환경(Lexical Environment)** 의 조합입니다. 
즉, 클로저는 함수가 외부 스코프에 있는 변수에 접근할 수 있도록 해주는 구조입니다.

이 말은 **외부 함수가 이미 종료된 뒤에도, 내부 함수가 외부 함수의 변수에 접근할 수 있다.** 는 것을 의미합니다.


### 🧐 간단한 예시
```js
function outer() {
    let count = 0;

    function inner() {
        count++;
        console.log(count);
    }

    return inner;
}

const counter = outer();
counter(); // 1
counter(); // 2
```
- `outer()` 실행 시, 지역 변수 `count`가 생성됩니다.
- `outer()` 는 `inner()` 함수를 반환하고 종료됩니다.
- 하지만 `counter()` 를 호출하면 여전히 `count`에 접근 가능 → 클로저 덕분입니다.

### 📌 핵심 포인트
1. 함수는 자신이 선언된 위치의 스코프를 기억합니다.
2. 외부 함수가 종료된 뒤에도, 해당 스코프가 메모리에서 유지됩니다.
3. 이 메모리 유지의 비밀이 바로 클로저입니다.

---

## 2️⃣ 다양한 예제
### 🧐 예제 1: 여러 개의 클로저 인스턴스
```js
function createCounter() {
    let count = 0;
    return function() {
        count++;
        return count;
    }
}

const counter1 = createCounter();
const counter2 = createCounter();

console.log(counter1()); // 1
console.log(counter1()); // 2
console.log(counter2()); // 1
```
- `conter1`과 `counter2`는 서로 다른 `count`를 유지 → 각 호출 시 새로운 렉시컬 환경이 만들어지기 때문.

### 🧐 예제 2: 파라미터 캡처
```js
function makeMultiplier(multiplier) {
    return function(number) {
        return number * multiplier;
    }
}

const double = makeMultiplier(2);
const triple = makeMultiplier(3);

console.log(double(5)); // 10
console.log(triple(5)); // 15
```
- `multiplier`는 `makeMultiplier` 실행이 끝난 후에도 내부 함수에서 계속 참조 가능


### 🧐 예제 3: 루프와 클로저
```js
var funcs = [];

for (var i = 0; i < 3; i++) {
    funcs.push(function() {
        console.log(i);
    });
}

funcs[0](); // 3
funcs[1](); // 3
funcs[2](); // 3
```
- `var`는 함수 스코프라서 같은 변수 `i`를 참조
- 해결법: IIFE(즉시실행함수) 또는 `let` 사용

```js
for (let i = 0; i < 3; i++) {
    funcs.push(function() {
        console.log(i);
    });
}
```

---

## 3️⃣ 실전 활용 패턴
### 🔹 데이터 은닉
```js
function createBankAccount(initialBalance) {
    let balance = initialBalance;

    return {
        deposit(amount) {
            balance += amount;
            return balance;
        },
        withdraw(amount) {
            balance -= amount;
            return balance;
        },
        getBalance() {
            return balance;
        }
    };
}
const account = createBankAccount(1000);
console.log(account.getBalance()); // 1000
account.deposit(500);
console.log(account.getBalance()); // 1500
```
- 외부에서 `balance` 직접 접근 불가 → **캡슐화**

### 🔹 once() 함수
```js
function once(fn) {
    let called = false;
    let result;

    return function(...args) {
        if (!called) {
            called = true;
            result = fn.apply(this, args);
        }
        return result;
    }
}

const init = once(() => console.log("Initialized"));
init(); // Initialized
init(); // 아무 일 없음
```